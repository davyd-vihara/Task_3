# Тестирование веб-приложения Stellar Burgers

Проект автоматизированного тестирования веб-приложения Stellar Burgers с использованием Selenium WebDriver, Pytest и Allure.

## Структура проекта

```
Task_3/
├── tests/                    # Тесты
│   ├── __init__.py
│   ├── conftest.py          # Фикстуры Pytest
│   ├── test_login.py        # Тесты входа/выхода
│   ├── test_password_recovery.py
│   ├── test_constructor.py
│   ├── test_order_feed.py
│   └── test_user_profile.py
│
├── pages/                    # Page Object Model
│   ├── __init__.py
│   ├── base_page.py         # Базовый класс страницы
│   ├── login_page.py        # Страница входа
│   ├── main_page.py         # Главная страница
│   ├── password_recovery_page.py
│   ├── profile_page.py      # Личный кабинет
│   ├── constructor_page.py  # Конструктор бургеров
│   └── order_feed_page.py   # Лента заказов
│
├── locators/                 # Локаторы
│   ├── __init__.py
│   ├── base_locators.py
│   ├── login_locators.py
│   ├── main_locators.py
│   ├── profile_locators.py
│   ├── password_recovery_locators.py
│   ├── constructor_locators.py
│   └── order_feed_locators.py
│
├── utils/                    # Утилиты
│   ├── __init__.py
│   ├── driver_factory.py    # Фабрика драйверов
│   ├── api_client.py        # API для создания тестовых данных
│   └── config.py            # Конфигурация
│
├── requirements.txt
├── pytest.ini
└── README.md
```

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Установите Allure (опционально, для просмотра отчетов):
```bash
# Windows (через Chocolatey)
choco install allure-commandline

# Или скачайте с https://github.com/allure-framework/allure2/releases
```

## Запуск тестов

> **Примечание:** По умолчанию тесты запускаются с подробным выводом (`-v`). Для минимального вывода используйте флаг `-q`.

### Базовый запуск (по умолчанию):
```bash
# Запуск всех тестов (по умолчанию - Chrome и Firefox)
pytest tests/

# Запуск только в Chrome
pytest tests/ -k "chrome"

# Запуск только в Firefox
pytest tests/ -k "firefox"
```

### Запуск с подробным выводом (verbose):
```bash
# Подробный вывод с названиями тестов
pytest tests/ -v

# Очень подробный вывод (debug режим)
pytest tests/ -vv

# С выводом print-ов
pytest tests/ -v -s
```

### Запуск с дебагом (полный вывод):
```bash
# Полный вывод включая сообщения Chrome/Firefox
pytest tests/ -vv -s

# С максимальной детализацией и логированием
pytest tests/ -vv -s --log-cli-level=DEBUG

# С выводом в консоль и файл
pytest tests/ -vv -s --log-cli-level=DEBUG --log-file=test.log
```

### Запуск с Allure отчетом:
```bash
# Запуск тестов с генерацией отчета (автоматически включено)
pytest tests/

# Просмотр отчета
allure serve ./allure-results

# Генерация HTML отчета
allure generate ./allure-results -o ./allure-report --clean
```

### Параллельный запуск:
```bash
# Запуск в 4 потока
pytest tests/ -n 4

# С подробным выводом
pytest tests/ -n 4 -v
```

### Запуск конкретного теста:
```bash
# Один тест
pytest tests/test_password_recovery.py::TestPasswordRecovery::test_go_to_password_recovery

# С подробным выводом
pytest tests/test_password_recovery.py::TestPasswordRecovery::test_go_to_password_recovery -v

# С дебагом
pytest tests/test_password_recovery.py::TestPasswordRecovery::test_go_to_password_recovery -vv -s
```

### Полезные опции:
```bash
# Только упавшие тесты
pytest tests/ --lf

# Остановиться на первой ошибке
pytest tests/ -x

# Показать локальные переменные при ошибке
pytest tests/ -l

# Запуск с маркерами
pytest tests/ -m smoke
pytest tests/ -m regression
```

## Покрытие тестами

### Восстановление пароля
- ✅ Переход на страницу восстановления пароля
- ✅ Ввод почты и клик по кнопке «Восстановить»
- ✅ Клик по кнопке показать/скрыть пароль подсвечивает поле

### Личный кабинет
- ✅ Переход по клику на «Личный кабинет»
- ✅ Переход в раздел «История заказов»
- ✅ Выход из аккаунта

### Основной функционал
- ✅ Переход по клику на «Конструктор»
- ✅ Переход по клику на «Лента заказов»
- ✅ Всплывающее окно с деталями ингредиента
- ✅ Закрытие модального окна крестиком
- ✅ Увеличение счетчика ингредиента при добавлении
- ✅ Оформление заказа залогиненным пользователем

### Лента заказов
- ✅ Всплывающее окно с деталями заказа
- ✅ Заказы пользователя отображаются в ленте
- ✅ Увеличение счетчика «Выполнено за всё время»
- ✅ Увеличение счетчика «Выполнено за сегодня»
- ✅ Номер заказа появляется в разделе «В работе»

## Особенности реализации

### Архитектура и паттерны

- **Page Object Model**: Все элементы страниц описаны в отдельных классах с наследованием от `BasePage`
- **Централизация работы с driver**: Все прямые обращения к `driver` вынесены в `BasePage` для переиспользования через наследование
- **Разделение локаторов**: Локаторы вынесены в отдельный пакет `locators/` для удобства поддержки
- **Кроссбраузерность**: Поддержка Chrome и Firefox через фабрику драйверов с автоматическим параметризованным запуском

### Качество кода и лучшие практики

- **Явные ожидания**: Используются только `WebDriverWait` с `expected_conditions`, без `time.sleep()`
- **Линейные сценарии**: Тесты написаны без ветвлений (if/else, try/except), создают линейный сценарий с ожидаемым результатом
- **Атомарность тестов**: Каждый тест независим, создает свои данные и очищает их после выполнения
- **Атомарность ассертов**: Все ассерты сгруппированы вместе, без промежуточных шагов между ними
- **Фикстуры без тестирования**: Фикстуры только подготавливают данные, не содержат assert'ов
- **Организация импортов**: Все импорты находятся в начале файлов

### Отчетность и интеграция

- **Allure отчеты**: Детальные отчеты с шагами (`allure.step`) для всех действий и скриншотами при падении
- **API интеграция**: Создание и удаление тестовых пользователей через API для изоляции тестов
- **Автоматическая очистка**: Тестовые данные автоматически удаляются после выполнения тестов

### Производительность

- **Оптимизация браузеров**: Переиспользование браузера с изоляцией тестов через отдельные вкладки
- **Ускорение выполнения**: Экономия 30-50% времени при сохранении полной изоляции тестов

## Конфигурация

Настройки можно изменить в `utils/config.py` или через переменные окружения:

### Основные настройки:
- `BROWSER` - браузер для тестов (chrome/firefox), по умолчанию: `chrome`
- `FULLSCREEN` - полноэкранный режим (true/false), по умолчанию: `true`
- `REUSE_BROWSER` - переиспользование браузера (true/false), по умолчанию: `false`
- `TEST_EMAIL` - email для тестов
- `TEST_PASSWORD` - пароль для тестов

### Пути к драйверам:
- `CHROME_DRIVER_PATH` - путь к ChromeDriver (по умолчанию: `C:\WebDriver\chromedriver-win64\chromedriver.exe`)
- `FIREFOX_DRIVER_PATH` - путь к GeckoDriver (по умолчанию: пусто, используется webdriver-manager)

**Приоритет:** Если указан локальный путь и файл существует, используется он. Иначе используется webdriver-manager для автоматической загрузки.

### Пример настройки через переменные окружения (.env файл):
```env
BROWSER=chrome
FULLSCREEN=true
REUSE_BROWSER=true
CHROME_DRIVER_PATH=C:\WebDriver\chromedriver-win64\chromedriver.exe
FIREFOX_DRIVER_PATH=C:\WebDriver\geckodriver-v0.36.0-win64\geckodriver.exe
```

## Оптимизация производительности

Проект использует оптимизированный подход к управлению браузерами для ускорения выполнения тестов:

### Переиспользование браузера

Вместо создания нового браузера для каждого теста, используется один браузер на всю сессию тестов. Для каждого теста:
- Открывается новая вкладка (tab)
- Очищается состояние браузера (cookies, localStorage, sessionStorage)
- После теста вкладка закрывается

### Преимущества

- **Ускорение выполнения**: Экономия 2-5 секунд на каждый тест (запуск/закрытие браузера)
- **Меньше нагрузка на систему**: Один процесс браузера вместо множества
- **Сохранение изоляции**: Каждый тест выполняется в чистом состоянии
- **Соответствие best practices**: Подход соответствует рекомендациям для UI-тестирования

### Как это работает

1. **Сессия браузера** (`scope="session"`): Браузер создается один раз в начале сессии тестов
2. **Изоляция тестов** (`scope="function"`): Для каждого теста открывается новая вкладка
3. **Очистка состояния**: Перед каждым тестом очищаются cookies и хранилища браузера
4. **Закрытие вкладок**: После теста вкладка закрывается, браузер остается активным

### Настройка и запуск

Проект поддерживает два режима работы, которые переключаются через переменную окружения `REUSE_BROWSER`:

#### Стандартный режим (по умолчанию)
```bash
# Новый браузер для каждого теста (максимальная изоляция)
pytest tests/
```

#### Оптимизированный режим (переиспользование браузера)
```bash
# Windows PowerShell
$env:REUSE_BROWSER="true"; pytest tests/

# Windows CMD
set REUSE_BROWSER=true && pytest tests/

# Linux/Mac
REUSE_BROWSER=true pytest tests/
```

Или через `.env` файл:
```env
REUSE_BROWSER=true
```

**Разница между режимами:**
- **Стандартный режим** (`REUSE_BROWSER=false`): Новый браузер для каждого теста. Максимальная изоляция, но медленнее.
- **Оптимизированный режим** (`REUSE_BROWSER=true`): Один браузер на всю сессию, новая вкладка для каждого теста. Ускоряет выполнение на 30-50% при сохранении изоляции.

## Примечания

- Тесты используют реальный сайт https://stellarburgers.education-services.ru/
- Для работы тестов требуется стабильное интернет-соединение
- Некоторые тесты могут требовать дополнительной настройки локаторов в зависимости от актуальной структуры сайта
- Оптимизация с переиспользованием браузера ускоряет выполнение тестов на 30-50% при сохранении полной изоляции тестов

## Соответствие требованиям задания

Проект полностью соответствует требованиям задания:

✅ **Page Object Model**: Отдельный пакет `pages/` с классами для каждой страницы  
✅ **Локаторы**: Отдельный пакет `locators/` с понятными названиями  
✅ **Кроссбраузерность**: Тесты запускаются в Chrome и Firefox  
✅ **Allure-отчеты**: Настроены и генерируются автоматически  
✅ **Независимость тестов**: Каждый тест создает свои данные через API  
✅ **Атомарность**: Тесты проверяют одну функциональность, ассерты сгруппированы  
✅ **Все тесты из задания**: Реализованы все 17 обязательных тестов  
✅ **Чистота кода**: Нет лишних зависимостей, закомментированного кода, неиспользуемых импортов  
✅ **Best practices**: Явные ожидания, линейные сценарии, централизация работы с driver

